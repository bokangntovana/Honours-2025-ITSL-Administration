@model Assignment
@{
    ViewData["Title"] = "Submissions";
}

<h2>Submissions for @Model.Title</h2>
<h4>Course: @Model.Course.CourseName</h4>

<table class="table">
    <thead>
        <tr>
            <th>Participant</th>
            <th>Submission Date</th>
            <th>File</th>
            <th>Grade</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var submission in Model.Submissions)
        {
            <tr>
                <td>@submission.Participant.FullName</td>
                <td>@submission.SubmissionDate.ToString("g")</td>
                <td>
                    @if (!string.IsNullOrEmpty(submission.FilePath))
                    {
                        <a asp-controller="Submission" asp-action="Download" asp-route-id="@submission.SubmissionId"
                           class="btn btn-sm btn-info">Download</a>
                    }
                    else if (Model.AssignmentType == AssignmentType.Quiz)
                    {
                        <span class="badge badge-success">Quiz Submission</span>
                    }
                    else
                    {
                        <span class="text-muted">No file</span>
                    }
                </td>
                <td>
                    @if (submission.Grade.HasValue)
                    {
                        <span>@submission.Grade / @Model.MaxPoints</span>
                        @if (!string.IsNullOrEmpty(submission.Feedback))
                        {
                            <br />
                            <small>@submission.Feedback</small>
                        }
                    }
                    else
                    {
                        <span class="text-muted">Not graded</span>
                    }
                </td>
                <td>
                    @if (Model.AssignmentType == AssignmentType.Quiz)
                    {
                        <a asp-controller="Submission" asp-action="QuizDetails" asp-route-submissionId="@submission.SubmissionId"
                           class="btn btn-sm btn-primary">View Answers</a>
                    }
                    <form asp-action="UpdateGrades" method="post" class="d-inline">
                        <input type="hidden" name="submissionId" value="@submission.SubmissionId" />
                        <div class="input-group">
                            <input type="number" name="grade" class="form-control" style="width: 80px;"
                                   min="0" max="@Model.MaxPoints" step="0.1"
                                   value="@(submission.Grade ?? Model.MaxPoints)" />
                            <div class="input-group-append">
                                <button type="submit" class="btn btn-sm btn-success">Grade</button>
                            </div>
                        </div>
                        <textarea name="feedback" class="form-control mt-1" rows="2"
                                  placeholder="Feedback">@submission.Feedback</textarea>
                    </form>
                </td>
            </tr>
        }
    </tbody>
</table>

<a asp-action="CourseAssignments" asp-route-courseId="@Model.CourseId" class="btn btn-secondary">Back to Assignments</a>